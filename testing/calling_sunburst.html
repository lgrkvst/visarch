<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Force based label placement</title>
		<script src="../js/lib/d3.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/lib/jquery.min.js" type="text/javascript" charset="utf-8"></script>		
		<script src="../js/lib/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/lib/bootstrap-switch.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/lib/typeahead.bundle.min.js" type="text/javascript" charset="utf-8"></script>
		

		<link rel="stylesheet" href="../css/lib/bootstrap.min.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="../css/lib/bootstrap-switch.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="../css/hr.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="../css/observatory.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="../css/radial.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="../css/static_footer.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="../css/typeahead.css" type="text/css" media="screen" charset="utf-8">
		<link href='http://fonts.googleapis.com/css?family=Stint+Ultra+Condensed' rel='stylesheet' type='text/css'>
		<style>
			.link {
				stroke: #CCC;
				stroke-width: 10px;
				opacity:0.1;
			}
			.node {
				opacity:0.8;
			}
			.nodelabel {
				font-family: optima, sans-serif;
				filter:none !important;
			}
			.radial {
				font-family: 'stint ultra condensed', tahoma,sans-serif;
				font-weight:100;
			}
			.nodelabeltext {
/*				opacity:0.3;
				font-size:3em; */
			}
			body {
				background-color: #000000;
				background-image: url('../css/themes/stellar/bg.old.jpg');
				background-position: top center;
				background-repeat: no-repeat;
				background-attachment: fixed;
				margin: 0px;
				font-size:12px;
			}
			.mouseover {
				opacity:0.5;
			}
			
		</style>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<script type="text/javascript" charset="utf-8">
					//http://stackoverflow.com/questions/9539294/adding-new-nodes-to-force-directed-layout


						var w = $(window).width(),
							h = $(window).height();
						var color = d3.scale.category20b();
							
						var svg = d3.select("body").append("svg")
						    .attr("width", w)
						    .attr("height", h)
						  .append("g")
						    .attr("transform", "translate(" + w / 2 + "," + (h / 2 + 10) + ")");
							
							// define gradients
//						svg.append("defs");
						  var gs = svg.append("defs").selectAll("defs")
						  	.data(color.range())
						  	.enter()
						  	.append("radialGradient")
						  	.attr("id", function (n, i) {
						  	return "m" + i;
						  }).attr("cx", "0%").attr("cy", "0%").attr("fx", "0%").attr("fy", "0%").attr("r", "100%");
						  gs.append("stop").attr("stop-color", function (n) {
						  	return d3.rgb(n).brighter();
						  }).attr("offset", "0%").attr("stop-opacity", "100%");
						  gs.append("stop").attr("stop-color", function (n) {
						  	return n;
						  }).attr("offset", "100%").attr("stop-opacity", "100%");

							svg.selectAll("defs")
								.append("g")
								.attr("id", "icon_remove")
								.append("polygon")
								.attr("points", "438.393,374.595 319.757,255.977 438.378,137.348 374.595,73.607 255.995,192.225 137.375,73.622 73.607,137.352 192.246,255.983 73.622,374.625 137.352,438.393 256.002,319.734 374.652,438.378")
								.attr("fill", "white")
								.attr("transform", "scale(0.03) translate(-80,150)");

							svg.selectAll("defs")
								.append("g")
								.attr("id", "icon_fixed")
								.append("path")
								.attr("d", "M20.812,19.5h5.002v-6.867c-0.028-1.706-0.61-3.807-2.172-5.841c-1.539-2.014-4.315-3.72-7.939-3.687C12.076,3.073,9.3,4.779,7.762,6.792C6.2,8.826,5.617,10.928,5.588,12.634V19.5h5v-6.866c-0.027-0.377,0.303-1.789,1.099-2.748c0.819-0.979,1.848-1.747,4.014-1.778c2.165,0.032,3.195,0.799,4.013,1.778c0.798,0.959,1.126,2.372,1.099,2.748V19.5L20.812,19.5zM25.814,25.579c0,0,0-2.354,0-5.079h-5.002c0,2.727,0,5.08,0,5.08l5.004-0.001H25.814zM5.588,25.58h5c0,0,0-2.354,0-5.08h-5C5.588,23.227,5.588,25.58,5.588,25.58z")
								.attr("fill", "white")
								.attr("transform", "scale(0.52) translate(-5,10)");
						     				
/*
							svg.selectAll("defs")
								.append("g")
								.attr("id", "icon_explode")
								.append("path")
								.attr("d", "M6.812,17.202l7.396-3.665v-2.164h-0.834c-0.414,0-0.808-0.084-1.167-0.237v1.159l-7.396,3.667v2.912h2V17.202zM26.561,18.875v-2.913l-7.396-3.666v-1.158c-0.358,0.152-0.753,0.236-1.166,0.236h-0.832l-0.001,2.164l7.396,3.666v1.672H26.561zM16.688,18.875v-7.501h-2v7.501H16.688zM27.875,19.875H23.25c-1.104,0-2,0.896-2,2V26.5c0,1.104,0.896,2,2,2h4.625c1.104,0,2-0.896,2-2v-4.625C29.875,20.771,28.979,19.875,27.875,19.875zM8.125,19.875H3.5c-1.104,0-2,0.896-2,2V26.5c0,1.104,0.896,2,2,2h4.625c1.104,0,2-0.896,2-2v-4.625C10.125,20.771,9.229,19.875,8.125,19.875zM13.375,10.375H18c1.104,0,2-0.896,2-2V3.75c0-1.104-0.896-2-2-2h-4.625c-1.104,0-2,0.896-2,2v4.625C11.375,9.479,12.271,10.375,13.375,10.375zM18,19.875h-4.625c-1.104,0-2,0.896-2,2V26.5c0,1.104,0.896,2,2,2H18c1.104,0,2-0.896,2-2v-4.625C20,20.771,19.104,19.875,18,19.875z")
								.attr("fill", "white")
								.attr("transform", "scale(1) rotate(180) translate(-30,-55)");
*/

							svg.selectAll("defs")
								.append("g")
								.attr("id", "icon_explode")
								.append("path")
								.attr("d", "m567.072327,32.324581l-142.898529,364.1077l-390.230839,26.652069l302.105686,248.419556l-95.20694,379.358398l329.609894,-210.542419l331.372925,207.780212l-98.380493,-378.565002l300.019348,-250.946625l-390.436523,-23.39035l-145.954529,-362.873539z")
								.attr("fill", "white")
								.attr("transform", "scale(0.015) translate(0,130)");





					</script>
					
					
					
					
					
					<script>

						/** Draw radial menu - a quite undocumented module at the moment.
						 * 
						 * @author Christian Lagerkvist [christian.lagerkvist@seb.se]
						 * Unfortunately, sunburst currently has a dependency to "groups", an array which functions as color-lookup. I'm ashamed.
							
							* Move stuff to css
						 */
							var radius = 180;

							var x = d3.scale.linear()
							    .range([0, 2 * Math.PI]);

							var y = d3.scale.sqrt()
							    .range([0, radius]);

						
							var partition = d3.layout.partition()
							    .sort(null)
							    .value(function(d) { return d.size; });

							var arc = d3.svg.arc()
							    .startAngle(function(d, i) { return Math.max(0, Math.min(2 * Math.PI, x(d.x))); })
							    .endAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x + d.dx))); })
							    .innerRadius(function(d) { return Math.max(0, y(d.y)); })
							    .outerRadius(function(d) { return Math.max(0, y(d.y + d.dy)); });
							
						function drawRadial(root, n) {
							var sunburst = svg.append("g").attr("class", "radial");
							sunburst.attr("transform", "translate(" + n.x + "," + n.y + ")");
						    var group = sunburst.datum(root).selectAll("g")
						        .data(partition.nodes)
						  	    .enter().append("g")	
								.on("mouseover", function(n) {
									this.setAttribute("class", "arc mouseover");
									})
								.on("mouseout", function(n) {
									this.setAttribute("class", "arc");
									})
								.on("mouseup", function(node) {
									if (node.callback) {
										node.callback(node);
										sunburst.remove();
									} else {
										expand(node);
									}
								});
								
							var path = group.append("path")
						        .attr("d", arc)
								.attr("id", function(d, i) {
									return "path" + i;
									})
								.attr("fill-opacity", function(d,i) {
									return d.depth ? 1 : 0;
									}) // hide inner ring
						        .style("fill", function(d, i) { 
									return "url(#m" + Math.floor(i/3)%20 + ")"; })
								.style("stroke", "#272727").style("stroke-width", "3px");

							var clip_path = group.append("clipPath")
								.attr("id", function(d, i) {
									return "clipPath" + i;
									})
								.append("use")
								.attr("xlink:href", function (n, i) {
									return "#path" + i;
								});
								
							var text = group.append("g")
								.attr("clip-path", function(n,i) {
									return "url(#clipPath" + i + ")";
								})
								.append("text")
								.attr("dy", function(d,i) {
									var x = d.depth;
									return 1.5*x*x-13.5*x+47;
									})
								// Text height in each circle sector
								// .attr("dy", function(d) {
								// 	console.log(d.depth)
								// 	return "27";
								// })
								.attr("class", "nodelabeltext")
								.attr("fill", function(n, i) {
									if (label(n).toUpperCase() == "GRYTET") {
										console.log("i is " + i);
										console.log(color(1));
									}
									
									return d3.rgb(color(Math.floor(i/3)%20)).brighter();
								})
								.attr("font-size", function(n){
									var x = n.depth;
									return 3*x*x-25*x+72;
								})
								.append("textPath")
									.attr("xlink:href", function(n, i) {
										return "#path" + i;
										})
									.text(label)
										.attr("startOffset", function(n){
											var x = n.depth;
											return (23+4.5*x-2.5*x*x) + "%";
										})
									.attr("text-anchor", "middle")
									.attr("letter-spacing", function(n){
										return 3-n.depth;
									});

						    function expand(d) {
								
						      path.transition()
						        .duration(250)
							  	.ease("cubic-out")
						        .attrTween("d", arcTweenZoom(d));
						    }
						}
						d3.select(self.frameElement).style("height", h + "px");


						// When zooming: interpolate the scales.
						function arcTweenZoom(d) {
						  var xd = d3.interpolate(x.domain(), [d.x, d.x + d.dx]),
						      yd = d3.interpolate(y.domain(), [d.y, 1]),
						      yr = d3.interpolate(y.range(), [d.y ? 20 : 0, radius]);
						  return function(d, i) {
						    return i
						        ? function(t) { return arc(d); }
						        : function(t) { x.domain(xd(t)); y.domain(yd(t)).range(yr(t)); return arc(d); };
						  };
						}
						
							
							/** Determine label text */
							function label(n) {
//								if (!n.children) return;
								var label = n.label || n.name || "";
								label = label.toUpperCase();
//								if (n.value == 1) return label.substring(0,1);
								return label;
							}
					</script>
					
					
					
					<script>
					var lces = JSON.parse('{"id":"_kj6SYO4eEeKkdbbircdmEA","size":14,"name":"LCES","group":"Processing Support Systems","size":12,"tag":"APP","index":0,"weight":0,"x":0.8829758936504,"y":0.2856600774035,"px":620.8869687205895,"py":280.2908698942541,"fixed":0}');
					
					var lces_tree = JSON.parse('{"size":12,"children":[{"size":14,"name":"remove","id":"_kj6SYO4eEeKkdbbircdmEA","icon":"#icon_remove"},{"size":14,"name":"Applications","id":"_kj6SYO4eEeKkdbbircdmEA","children":[{"id":"_agmCcNOHEeKnyLpxuAUlyg","size":14,"name":"Aquarius","group":"Financing&Loans Systems","size":6},{"id":"_9zfWAM9uEeKTytfvtcsKjg","size":14,"name":"BIF","group":"Financing&Loans Systems","size":5},{"id":"_327Q8M9uEeKTytfvtcsKjg","size":14,"name":"Origo","group":"Financing&Loans Systems","size":12},{"id":"_Jv-KcKKeEeKvjd3eYA2x1A","size":14,"name":"Säljstöd","group":"Front System","size":53},{"id":"_Jv-KcKKeEeKvjd3eYA2x1A","size":14,"name":"Säljstöd","group":"Front System","size":53},{"id":"_Qv0KULCoEeKB3PjRdgQmKA","size":14,"name":"Kofax (TopCall)","group":"Processing Support Systems","size":7},{"id":"_fQC3AJCSEeKhnLIkYfvrAg","size":14,"name":"VDR","description":"Archive","group":"Processing Support Systems","size":17},{"id":"_4bDBoO4uEeKkdbbircdmEA","size":14,"name":"SPIK/Nödlid","description":"Case Management","group":"Processing Support Systems","size":4},{"id":"_hZVIIOTbEeKA2uegIInhsA","size":14,"name":"SEB Case","description":"Case Management","group":"Processing Support Systems","size":10},{"id":"_MkHKAO4hEeKkdbbircdmEA","size":14,"name":"CGI (Logica)","description":"External","group":"ExternalSystems","size":2},{"id":"_U6pXIO4hEeKkdbbircdmEA","size":14,"name":"Itella","description":"External","group":"ExternalSystems","size":3},{"id":"_HE3ewBryEeO66eJdk956ug","size":14,"name":"CSM 2","group":"Securities Systems","size":11}]},{"size":14,"name":"Processes","id":"_kj6SYO4eEeKkdbbircdmEA","children":[{"size":14,"name":"Retail","children":[{"size":14,"name":"Enkla Lånet"}]}]},{"size":14,"name":"Platforms","id":"_kj6SYO4eEeKkdbbircdmEA","children":[{"size":14,"name":"Rissne","children":[{"size":14,"name":"wsp1001a"},{"size":14,"name":"wsp1001b"},{"size":14,"name":"wsp1001c"}]},{"size":14,"name":"Grytet","children":[{"size":14,"name":"wsp1002a"},{"size":14,"name":"wsp1002b"},{"size":14,"name":"wsp1002c"}]}]}]}');
						
					drawRadial(lces_tree, lces);
					
					</script>
				</div>
			</div>
		</div>
	</body>

</html>