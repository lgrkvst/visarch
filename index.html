<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>The Observatory</title>
		<script src="js/lib/d3.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/jquery.min.js" type="text/javascript" charset="utf-8"></script>		
		<script src="js/lib/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/bootstrap-switch.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/typeahead.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/hogan-2.0.0.min.js" type="text/javascript" charset="utf-8"></script>

		<script type='text/javascript' src='js/ALL.js'></script>
		<script type='text/javascript' src='js/Net.js'></script>
		<script type='text/javascript' src='js/Force.js'></script>
		<script type='text/javascript' src='js/Compartments.js'></script>
		<script type='text/javascript' src='js/sunburst.js'></script>
		<script type='text/javascript' src='js/helpers.js'></script>
		
		<link rel="stylesheet" href="css/lib/bootstrap.min.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="css/lib/bootstrap-switch.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="css/themes/stellar/theme.css" type="text/css" media="screen" charset="utf-8" id="css_theme">
		<link rel="stylesheet" href="css/hr.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="css/observatory.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="css/radial.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="css/static_footer.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="css/typeahead.css" type="text/css" media="screen" charset="utf-8">
		
		<script type="text/javascript">
		var Settings = function(){
			return {
				drawOrigo: false,
				rotateLabels: true,
				drawAngles: false,
			}
		}();
		$(function() {
			// catch window resize and reinstantiate svg container and force network
			$(window).resize(function() {
				var w = $(window).width(),
					h = $(window).height()-42*2;

				d3.select("#observatory").attr("width", w).attr("height", h);				
				Force.force().size([w, h]);
				update();
			});


			// sliders for tweaking the force layout
		    d3.select("#linkConstant")
			    .on("change",function() { 
					d3.select("#linkLabel").text("linkConstant: "+Net.linkConstantUpdate(this.value));
					});
			d3.select("#sizeConstant")
			    .on("change",function() { 
					d3.select("#sizeLabel").text("sizeConstant: "+Net.sizeConstantUpdate(this.value));
					});



			$('#rotateLabels').popover({animation:false, placement: "top", trigger: "hover", title: "", content: "Each label's angle is calculated from the positions of neighbouring nodes, hoping to reduce clutter."});

			$('#rotateLabels').on('switch-change', function (e, data) {
				Settings.rotateLabels = data.value
				update(true);
			});

			$('#themeswitcher').on('change', function (e, data) {
				var base_path = "css/themes/"
				document.getElementById('css_theme').href=base_path+this.value+'/theme.css';
			});
				
			$('#jumpref').click(function(){
			    $('html, body').animate({
			        scrollTop: $( $.attr(this, 'href') ).offset().top
			    }, 500);
			    return false;
			});
		});
		$(document).ready(function() {
			$('#q').focus();
		});		



		</script>
	</head>
	<body>
		<div class="navbar navbar-inverse">
			<span class="navbar-brand" style="font-weight: normal; font-size:2em; padding-top:18px; margin-left:15px !important">The&nbsp;Observatory</span>
			<span style="min-width:132px" class="btn navbar-btn pull-right pull-right" id="bookmarks">
			</span>
			<span class="pull-right">
				<form class="navbar-form">
					<input id="q" type="text" placeholder="Search..." autocomplete="off" spellcheck="false" dir="auto"/>				
					<script>
					$('#q').on('typeahead:selected', onAdd);
					/* autoselect first match on enter */
					$('#q').keypress(function (e) {
					    if (e.which == 13) {
					        var node = $('#q').data().ttView.dropdownView.getFirstSuggestion().datum;
							onAdd(null, node);
							$(this).typeahead('setQuery', '');
							
					    }
					});
					function onAdd (e, datum) {
						if(datum.description == "compartment") { // add entire compartment
							var ns = ALL.nsByCompartment(datum.id);
							ns.forEach(function (n, i) {
								if (n.size>0) Net.add(ALL.n(n.id));
								});

						} else Net.add(ALL.n(datum.id), ALL.node2links); // add system
						update();						
						$(this).typeahead('setQuery', '');
					  }
					</script>
				</form>
			</span>
		</div>
	</div>



	<div id="wrap" oncontextmenu="return false;">
		<div id="main" class="clear-top" style=" border-bottom:1px gray">
			<div class="row-fluid">
				<div class="col-12" id="background"><svg id="observatory"></svg>
					<script type='text/javascript' src='js/draw.js'></script>
				</div>
			</div>
			<!--
			<div id="some_settings_that_only_i_can_see" style="background:#fff">
				<div class="row-fluid">
			        <span class="col-6">
						<div id="linkLabel">linkConstant:</div>
			        	<div class="col-3"><input type="range" min="0" max="30" value="25" id="linkConstant" step="0.01"/></div>
					</span>
			        <span class="col-6">
						<div id="sizeLabel">sizeConstant:</div>
			        	<div class="col-3"><input type="range" min="0" max="100" value="1" id="sizeConstant" step="0.01"/></div>
					</span>
				</div>
			</div>
			-->
			<div class="text-center jump">
				<a id="jumpref" href="#jump">
					<i class="icon-chevron-down"></i>
					<strong>scroll down for more info</strong>
					<i class="icon-chevron-down"></i>
				</a>
			</div>
		</div>
	</div>
	<hr> <!-- styled in hr.css -->
	<div class="container-fluid content">
		<div class="row-fluid">
			<span class="col-sm-12">
				<div class="page-header">
					<h1 id="jump">
						The Observatory <small> &mdash; A Solution Architecture Overview <sup><small><a href="docs/index.html">[docs]</a></sup></small></small>
					</h1>
				</div>
			</span>
			
			<div class="col-sm-12 lead">The Observatory lets you visualize arbitrary SEB systems, along with their integrations, in a <a href="http://en.wikipedia.org/wiki/Force-directed_graph_drawing">force-directed network</a>. The Observatory gets its data directly from the &quot;<abbr title="Defining a Solution Architecture Overview is an initiative within Application Infrastructure">SAO</abbr> <abbr title="IBM RSA is a UML tool for describing enterprise architecture">RSA</abbr>&quot; model, maintained by SEB's <abbr title="Solution Area Architect, a role within Application Infrastructure">SAA's.</abbr></div>
		</div>
		<div class="row-fluid">
			<div class="col-sm-4">
				<h2>
					Searching
				</h2>
				<p>
					Enter the name of any system(s) into the seach field and press <span class="label label-primary">RETURN</span> on your keyboard. Each system you add will be represented by a star, along with integrations to other (visualized) systems.
				</p>
				<p>
You can add entire compartments by passing its name within square brackets, e.g. <span class="label label-info">[Processing Support]</span>.					</p>
			</div>
			<div class="col-sm-4">
				<h2>
					Navigating
				</h2>
				<p>Nodes are layed out using a force-directed system. You can tweak the layout by dragging nodes into place.</p><p><span class="label label-warning">Right-clicking</span> any system brings up a context menu, allowing you to delete, add or explode ("supernova") that system, effectively bringing all its integrations into view.
			</div>
			<div class="col-sm-4">
				<h2>
					Saving
				</h2>
				<p>
					Currently, the Observatory supports saving <em>links</em> to layouts (i.e. not images). The <span class="label label-success">save</span> link beside the search bar is a <em>bookmarklet</em> which represents the current state of your layout. Drag this button into the bookmarks bar of your browser to save the state.</p><p> The <span class="label label-danger">&lt; back</span> link represents the previous state, and effectively serves as an <em>undo</em> button.</p>
				</p>
			</div>
		</div>
		<div style="height:20px"></div>
		<div class="row-fluid">
			<div class="col-sm-12">
				<div class="col-sm-4 bs-callout bs-callout-info">
					<div class="col-sm-6">
						<div>
						<label>Rotate labels</label>
						</div>
						<div id="rotateLabels" class="make-switch switch-mini">
						    <input type="checkbox" checked />
						</div>&nbsp;<i class="icon-question-sign"></i>
					</div>
					<div class="col-sm-6">
						<label>Theme</label>
						<div>
							<select class="input-small" id="themeswitcher">
							  <option value="stellar" selected>Stellar</option>
							  <option value="cartographer">Cartographer</option>
							  <option value="meadow">Meadow</option>
							</select>
						</div>
					</div>
				</div>
				<div class="col-sm-4"></div>
				<blockquote class="pull-right">
					<p>
						Idea, design &amp; implementation
					</p> <small><a href="mailto:christian.lagerkvist@seb.se">Christian Lagerkvist</a>, SAA Processing Support</small>
				</blockquote>
			</div>
		</div>
	</div>
	<script>
	function JsonReady() {
//		Net.add(ALL.nByName("inlån")[0]);
//		Net.add(ALL.nByName("loro")[0]);
//		Net.add(ALL.nByName("cois")[0]);
//		Net.add(ALL.nByName("vdr")[0]);
//		Net.add(ALL.nByName("kurre")[0]);
//		update();
	}
	</script>

</body>
</html>
